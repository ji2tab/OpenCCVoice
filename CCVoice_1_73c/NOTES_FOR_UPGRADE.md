
# OpenCCVoice Guidance Controller  
# アップグレード注意点（v1.73c）
# 最終更新日: 2026-01-26

本書は、OpenCCVoice を **v1.73c** にアップグレードする際の
重要な注意点・確認手順をまとめたドキュメントです。
特に **v1.73b / v1.73a / v1.72 / v1.69系** からの更新時にご確認ください。

---

## 1. 重要：EEPROM のバージョン管理（version stamp）の導入

**v1.73c から EEPROM にレイアウト版（`config.ver`）を導入**しました。
これにより、スケッチ更新後の **設定破損や不定値の混入を自動で防止**します。

### 仕組み（起動時の自動判定）
- `config.magic`（このプロジェクトの識別子）を確認  
- `config.ver`（EEPROMレイアウトの世代）を確認  
- 期待値と一致しない場合：
  - **自動マイグレーション（移行）** または **初期化** を実行  
  - 新規項目（例：`tmBusyActiveHigh` / `dfpTimeoutMs`）は安全な既定値で補完

> **ポイント**：  
> これにより、**スケッチ書き込み後に “F（初期化）” を必ず実行する必要はありません**。  
> ただし、完全にクリーンな状態で再構成したい場合は実行を推奨します（後述）。

---

## 2. v1.73b/c で追加された主な項目（旧EEPROMでは未定義）

- `tmBusyActiveHigh` … D6（TM BUSY）極性（**g0/g1** で変更）
- `dfpTimeoutMs` … DFPlayer フェイルセーフ時間（**d####** で変更／**d0** で無効）
- `ver` … EEPROM レイアウト版（**v1.73c では 3**）

### 旧EEPROMから読み込んだ場合の自動補完（v1.73c の挙動）
- `tmBusyActiveHigh = 1`（**HIGH=BUSY** として扱う）
- `dfpTimeoutMs = 20000`（**20秒**）
- `ver = 3` に更新

> これにより、以下の不具合を未然に防ぎます：  
> ・BUSY 極性の逆転（IDが出ない／乱発する）  
> ・PTT の張り付き  
> ・フェイルセーフの予期せぬ誤動作  
> ・AUTO 判定の誤り

---

## 3. 書き込み直後の正常な挙動

### 起動時の想定ログ
