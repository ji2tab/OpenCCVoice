
```text
========================================================================
 OpenCCVoice Guidance Controller 
 取扱説明書 / コマンドリファレンス
========================================================================

バージョン: 1.72-final-EEPROM+F (Factory Reset対応)
最終更新日: 2026/01/20
対象ハード: Arduino Nano (ATmega328P / 5V)
通信設定 : 115200 bps / 8N1 / 改行なし(またはLF)

========================================================================
■ 概要
本機は TM-8250 無線機のID送出を自動制御するコントローラです。
PCとUSB接続し、シリアルモニタから以下のコマンドで設定を変更できます。
変更した設定は即座に内部メモリ（EEPROM）に保存され、電源を切っても維持されます。

========================================================================
1. クイック・コマンド一覧
========================================================================
[コマンド] [パラメータ] [既定値] [機能説明]

 m  0 / 1 / 2   0       動作モード切替
                 (0:D6固定 / 1:A0固定 / 2:AUTO)

 b  500〜1500  1500    最大受信時間(ms)
                 ※これを超えると長会話とみなす

 n  100〜500   100     最小受信時間(ms)
                 ※これ未満はノイズとして無視

 s  0 / 1       1       抑止機能 ON/OFF (長会話・連打対策)

 t  0 / 1       1       送信後無視 ON/OFF (s1時のみ有効)

 r  0〜3000     -       送信終了後の受信無視時間(ms)

 p  0〜30       -       周期ID送出間隔(分) ※0で停止

 w  1〜30       -       AUTOモード 判定期間(分)

 L  0〜1023     300     A0アナログ検知 感度下限
 G  0〜1023     700     A0アナログ検知 感度上限
 a  0〜800      -       A0アナログ検知 保持時間(ms)

 q  なし        -       設定値一覧表示
 H  なし        -       H1現場用プリセット
 x  なし        -       システム停止(保守用・PTT禁止)
 r  なし        -       「x」で停止した処理を再開
 F  なし        -       ★新規★ 初期設定へ戻す
                         (EEPROM初期化 + applyDefaults)

========================================================================
2. コマンド詳細解説
========================================================================

【m：モード設定】
 m0 : デジタル信号(D6)を使用します。[推奨]  
 m1 : アナログ音声(A0)を使用します。  
 m2 : 自動判定(AUTO)を開始します。  
       設定した「w(分)」の間データを測定し、適切な方へ自動で切替。  
       (判定中はD6/A0両方の信号でID送出)

【b：最大受信時間】
 相手の送信がこの時間(ミリ秒)を超えると「通話」と判断しID送出しない。  
 長会話直後はID送出を一定時間禁止。  
 例) b3000 → 3秒以上の受信にIDを出さない。

【s / t / r：抑止ガード】
 ID乱発を防ぐ機能。通常は s1 / t1 推奨。
 ・s1 : 長会話後や短い連打(バースト)を検知するとID禁止  
 ・t1 : 自分がID送出直後、r(ms)の間受信を無視  
        → 回り込み誤動作を防止

【H：H1プリセット】
 カーチャンクが長い現場用の緊急設定。送信するだけで以下を強制適用：
 ・s = OFF  
 ・t = OFF  
 ・b = 3900 (3.9秒)

【x / r：停止と再開】
 x : 一切の動作(PTT/LED/判定)を停止(Safe Stop)  
 r : 停止状態を解除し通常動作へ復帰  

【F：初期値へリセット】 ★追加
 F : すべての設定を工場出荷時に戻す  
 ・applyDefaults() 実行  
 ・saveSettings() で EEPROM へ保存  
 → 電源を切っても初期状態のまま

========================================================================
3. LED表示の意味
========================================================================
[D4] (D6 LED)   : 点灯 = D6信号受信中  
[D12] (A0 LED)  : 点灯 = A0音声検知中  
   ※AUTO判定中は D4/D12 が交互点滅  

[D13] (抑止LED) : 点灯 = 抑止中 (長会話直後などでID禁止)  
                 点滅 = バースト検知  
                 高速点滅 = AUTOモードで設定確定 (3秒)

========================================================================
4. トラブルシューティング
========================================================================

・IDが出ない  
 → 「x」で停止していませんか？ r で再開可能  
 → b が短すぎないか？ 例: b3000 推奨  
 → D13 点灯 = 抑止機能が動作中  

・IDが出続ける / 止まらない  
 → t1 にして r を大きく設定(例: r5000)  
 → ノイズの可能性 → n を上げる  

・設定がおかしい / 元に戻したい  
 → 「F」で初期設定へ戻せます (EEPROMも初期化)

========================================================================
```
